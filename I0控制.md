## Coentents

- [I/O](#I/O)

## I/O

### I/O缓存

![用户数据传输到disk](img/用户数据传输到disk.png)

linux中用户数据传送到磁盘的过程如上图。

read()/wirte()是基本的I/O读写系统调用，在这两个系统调用和真实的磁盘读写之间存在一个Kernel buffer cache（内核缓冲区缓存）；Kernel buffer cache是为了加快读/写。

Kernel buffer cache由Page Cache和Buffer Cache组成。

1. 读磁盘：内核查看Page Cache中是否已经缓存这个数据
> 存在则直接读；不存在则穿透到磁盘中读取，并将数据缓存在Page buffer

2. 写磁盘：内核把数据写入Page Cache，将这一页标记为dirty，将其添加入dirty list
> 定期将dirty list中的页缓存flush到磁盘，保证磁盘和页缓存一致性

Page Cache定期使用页面置换算法（如LRU）淘汰旧页面，且Page Cache是基于虚拟内存的页单元缓存。
> Kernel -> Kernel Buffer Cache -> Disk

Linux 2.4版本后，Page Cache和Buffer Cache进行了统一。

如下图所示，Buffer Cache内嵌入Page Cache中；处理文件I/O缓存交给Page Ceche，底层RAW Device刷新数据时以Buffer Cache的快单位来实际处理。

![融合Page和Buffer.png](img/融合Page和Buffer.png)